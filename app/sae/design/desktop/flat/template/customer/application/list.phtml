<?php$application = $this->getApplication();$limit = 100;$offset = 0;$customers = new Customer_Model_Customer();$customers = $customers->findAllCustomersByApp(array("app_id" => $application->getId()), array("limit" => $limit, "offset" => $offset));$nb_customers = 0;?><div class="row">    <div class="col-md-12">        <div class="page-content-wrapper form-horizontal">            <div class="content solo-page">                <h3 class="title-editor border-blue text-center">                    <?php echo __("Users"); ?>                </h3>                <div class="subcontent content-color container-fluid">                    <div class="form-group">                        <div class="col-md-12">                            <button id="add_customer" class="color-blue btn sb-tour">                                <?php echo __("Add"); ?>                            </button>                        </div>                    </div>                    <?php if(count($customers)): ?>                        <div class="form-group">                            <div class="col-md-2">                                <input id="tb_search" type="text" class="input-flat sb-tour" value="" placeholder="<?php echo __("Search..."); ?>" />                            </div>                        </div>                    <?php endif; ?>                    <div class="form-group">                        <?php if(count($customers)): ?>                            <div class="col-md-12">                                <table id="table_customers_list" class="table inner_content panel sb-tour">                                    <col width="0%" />                                    <col width="40%" />                                    <col width="35%" />                                    <col width="20%" />                                    <col width="5%" />                                    <tr>                                        <th class="border-blue"></th>                                        <th class="border-blue"><?php echo __("Email"); ?></th>                                        <th class="border-blue"><?php echo __("User"); ?></th>                                        <th class="border-blue"><?php echo __("Created at"); ?></th>                                        <th class="border-blue"><?php echo __("Actions"); ?></th>                                    </tr>                                    <?php foreach($customers as $customer) : ?>                                        <?php $nb_customers = $customer->getNbCustomer() ? $customer->getNbCustomer() : 0; ?>                                        <tr id="row_customer_<?php echo $customer->getId(); ?>" class="row_customer_list">                                            <td></td>                                            <td><?php echo $customer->getEmail(); ?></td>                                            <td><?php echo $customer->getName(); ?></td>                                            <td><?php echo $customer->getCreatedAt(); ?></td>                                            <td class="text-center">                                                <a href="<?php echo $this->getUrl("customer/application/edit", array("customer_id" => $customer->getId())); ?>"><i class="fa fa-edit"></i></a>                                                <a href="#" class="delete_customer">                                                    <i class="fa fa-times"></i>                                                    <input type="hidden" name="customer_id" value="<?php echo $customer->getId() ?>" />                                                </a>                                            </td>                                        </tr>                                    <?php endforeach; ?>                                </table>                            </div>                        <?php else: ?>                            <div class="col-md-12">                                <?php echo __("No user for now."); ?>                            </div>                        <?php endif; ?>                        <div class="col-md-12" id="no_result_search" style="display:none">                            <?php echo __("No user match your request."); ?>                        </div>                    </div>                    <?php if(count($customers)): ?>                        <div class="form-group" id="form_customer_paginate">                            <div class="col-md-12 text-right">                                <button id="bt_customer_previous" class="color-blue btn" style="display:none"><</button>                                <span id="pages"></span>                                <button id="bt_customer_next" class="color-blue btn">></button>                                <input type="hidden" id="limit" name="limit" value="<?php echo $limit; ?>" />                                <input type="hidden" id="offset" name="offset" value="<?php echo $offset; ?>" />                                <input type="hidden" id="search_value" name="search_value" value="" />                            </div>                        </div>                    <?php endif; ?>                </div>            </div>        </div>    </div></div><script type="text/javascript">    var fixed_limit = <?php echo $limit; ?>;    var limit = <?php echo $limit; ?>;    var offset = <?php echo $offset; ?>;    var current_page = 1;    var nb_pages = <?php echo $nb_customers ?>;    $(document).ready(function() {        nb_pages = Math.ceil(nb_pages/fixed_limit);        majPages();        majDisplayButtons();        bindDeleteButton();        $('#add_customer').click(function() {            window.location = "<?php echo $this->getUrl("customer/application/new"); ?>";        });        $('#bt_customer_next').click(function() {            if(current_page < nb_pages) {                offset += limit;                current_page++;            }            majDisplayButtons();            $("#offset").val(offset);            $("#limit").val(limit);            reload($("#form_customer_paginate"), "<?php echo $this->getUrl("customer/application/getuserslistpaginate"); ?>", true, function(data) {                if(data.customers.length) {                    majCustomers(data.customers);                }                majPages();            });            $("#bt_customer_previous").show();            return false;        });        $('#bt_customer_previous').click(function() {            if(current_page > 1) {                offset -= limit;                current_page--;            }            majDisplayButtons();            $("#offset").val(offset);            $("#limit").val(limit);            reload($("#form_customer_paginate"), "<?php echo $this->getUrl("customer/application/getuserslistpaginate"); ?>", true, function(data) {                if(data.customers.length) {                    majCustomers(data.customers);                }                majPages();            });            $("#bt_customer_next").show();            return false;        });        $("#tb_search").keyup(function() {            $("#search_value").val($("#tb_search").val());            $("#offset").val(0);            $("#limit").val(fixed_limit);            reload($("#form_customer_paginate"), "<?php echo $this->getUrl("customer/application/getuserslistpaginate"); ?>", false, function(data) {                if (data.customers.length) {                    $("#no_result_search").hide();                    nb_pages = Math.ceil(data.customers[0].nb_customer / fixed_limit);                    majCustomers(data.customers);                } else {                    nb_pages = 0;                    majCustomers(new Array());                    $("#no_result_search").show();                }                offset = 0;                current_page = 1;                majPages();                majDisplayButtons();            });        });    });    function majDisplayButtons() {        if(current_page <= 1) {            $("#bt_customer_previous").hide();        } else {            $("#bt_customer_previous").show();        }        if(current_page >= nb_pages) {            $("#bt_customer_next").hide();        } else {            $("#bt_customer_next").show();        }    }    function majPages() {        $("#pages").html(current_page + "/" + nb_pages);    }    function majCustomers(customers) {        $(".row_customer_list").remove();        $(customers).each(function(index, customer) {            tp = '<tr id="row_customer_' + customer.customer_id + '" class="row_customer_list">' +            '<td></td>' +            '<td>' + customer.email + '</td>' +            '<td>' + customer.firstname + ' ' + customer.lastname + '</td>' +            '<td>' + customer.created_at + '</td>' +            '<td class="text-center">' +            '<a href="/customer/application/edit/customer_id/' + customer.customer_id + '"><i class="fa fa-edit"></i></a>' +            '<a href="#" class="delete_customer">' +            '<i class="fa fa-times"></i>' +            '<input type="hidden" name="customer_id" value="' + customer.customer_id + '" />' +            '</a>' +            '</td>' +            '</tr>';            $("#table_customers_list").append($(tp));        });        bindDeleteButton();    }    function bindDeleteButton() {        $( ".delete_customer").unbind( "click" );        $('.delete_customer').click(function() {            if(confirm("<?php echo addslashes(__("Are you sure you want to remove this user?"));?>")) {                reload(this, "<?php echo $this->getUrl("customer/application/delete"); ?>", true, function(data) {                    if(data.success) {                        $('#row_customer_'+data.customer_id).fadeOut(300, function() {$(this).remove();})                    }                });            }            return false;        });    }</script>